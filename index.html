<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±–ª—ñ–∫ –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–∞—à —Å—Ç–∏–ª—å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω */
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã –û–±–ª—ñ–∫ –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó</h1>
        <p>–°–∏—Å—Ç–µ–º–∞ –æ–±–ª—ñ–∫—É –≤—Ö—ñ–¥–Ω–æ—ó —Ç–∞ –≤–∏—Ö—ñ–¥–Ω–æ—ó –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó</p>
    </div>

    <div class="stats-container">
        <div class="stat-card" id="incomingStatCard">
            <div class="stat-number" id="incomingCount">0</div>
            <div class="stat-label">–í—Ö—ñ–¥–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏</div>
        </div>
        <div class="stat-card" id="outgoingStatCard">
            <div class="stat-number" id="outgoingCount">0</div>
            <div class="stat-label">–í–∏—Ö—ñ–¥–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏</div>
        </div>
    </div>

    <div class="menu-grid">
        <button class="menu-item" id="showIncomingFormButton">
            <span class="icon">üì•</span>
            <span class="title">–ù–æ–≤–∞ –≤—Ö—ñ–¥–Ω–∞</span>
        </button>
        <button class="menu-item" id="showOutgoingFormButton">
            <span class="icon">üì§</span>
            <span class="title">–ù–æ–≤–∞ –≤–∏—Ö—ñ–¥–Ω–∞</span>
        </button>
        <button class="menu-item" id="showSearchButton">
            <span class="icon">üîç</span>
            <span class="title">–ü–æ—à—É–∫</span>
        </button>
        <button class="menu-item" id="showHelpButton">
            <span class="icon">‚ÑπÔ∏è</span>
            <span class="title">–î–æ–≤—ñ–¥–∫–∞</span>
        </button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—Ö—ñ–¥–Ω–æ—ó –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó -->
    <div class="form-container" id="incomingForm">
        <h3>üì• –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–æ—ó –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó</h3>
        <form id="incomingFormData">
            <!-- –í–∞—à—ñ —ñ–Ω–ø—É—Ç –ø–æ–ª—è -->
            <button type="submit" class="btn">‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</button>
            <button type="button" class="btn btn-secondary" id="cancelIncomingFormButton">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–∏—Ö—ñ–¥–Ω–æ—ó –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó -->
    <div class="form-container" id="outgoingForm">
        <h3>üì§ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–∏—Ö—ñ–¥–Ω–æ—ó –∫–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—ó</h3>
        <form id="outgoingFormData">
            <!-- –í–∞—à—ñ —ñ–Ω–ø—É—Ç –ø–æ–ª—è -->
            <button type="submit" class="btn">‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</button>
            <button type="button" class="btn btn-secondary" id="cancelOutgoingFormButton">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
    </div>

    <div class="search-container" id="searchContainer">
        <h3>üîç –ü–æ—à—É–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h3>
        <input type="text" id="searchQuery" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ—à—É–∫—É">
        <button class="btn" id="performSearchButton">üîç –ó–Ω–∞–π—Ç–∏</button>
        <button class="btn btn-secondary" id="cancelSearchButton">‚ùå –ó–∞–∫—Ä–∏—Ç–∏</button>
        <div class="search-results" id="searchResults"></div>
    </div>

    <div class="form-container" id="helpContainer">
        <h3>‚ÑπÔ∏è –î–æ–≤—ñ–¥–∫–∞ –ø–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—é</h3>
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–≤—ñ–¥–∫–∏ -->
        <button class="btn btn-secondary" id="closeHelpButton">‚ùå –ó–∞–∫—Ä–∏—Ç–∏ –¥–æ–≤—ñ–¥–∫—É</button>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;

        if (tg) {
            tg.ready();
            tg.expand();
        }

        class DocumentDatabase {
            constructor() {
                this.incomingKey = 'correspondence_incoming';
                this.outgoingKey = 'correspondence_outgoing';
                this.counterKey = 'correspondence_counters';
            }

            getIncoming() {
                return JSON.parse(localStorage.getItem(this.incomingKey) || '[]');
            }

            getOutgoing() {
                return JSON.parse(localStorage.getItem(this.outgoingKey) || '[]');
            }

            saveIncoming(documents) {
                localStorage.setItem(this.incomingKey, JSON.stringify(documents));
            }

            saveOutgoing(documents) {
                localStorage.setItem(this.outgoingKey, JSON.stringify(documents));
            }

            getCounters() {
                return JSON.parse(localStorage.getItem(this.counterKey) || '{"incoming": 0, "outgoing": 0}');
            }

            saveCounters(counters) {
                localStorage.setItem(this.counterKey, JSON.stringify(counters));
            }

            generateDocNumber(type) {
                const counters = this.getCounters();
                const date = new Date();
                const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');
                
                counters[type]++;
                this.saveCounters(counters);
                
                const prefix = type === 'incoming' ? 'IN' : 'OUT';
                const number = String(counters[type]).padStart(3, '0');
                
                return `${prefix}-${dateStr}-${number}`;
            }

            addDocument(type, data, docNumber = null) {
                const documents = type === 'incoming' ? this.getIncoming() : this.getOutgoing();
                const document = {
                    id: Date.now(),
                    docNumber: docNumber || this.generateDocNumber(type),
                    ...data,
                    createdAt: new Date().toISOString()
                };
                documents.push(document);
                if (type === 'incoming') {
                    this.saveIncoming(documents);
                } else {
                    this.saveOutgoing(documents);
                }
                return document;
            }
        }

        const db = new DocumentDatabase();

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const incoming = db.getIncoming();
            const outgoing = db.getOutgoing();
            document.getElementById('incomingCount').textContent = incoming.length;
            document.getElementById('outgoingCount').textContent = outgoing.length;
        }

        // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
        document.getElementById('showIncomingFormButton').addEventListener('click', function() {
            showForm('incoming');
        });

        document.getElementById('showOutgoingFormButton').addEventListener('click', function() {
            showForm('outgoing');
        });

        document.getElementById('cancelIncomingFormButton').addEventListener('click', hideAllForms);
        document.getElementById('cancelOutgoingFormButton').addEventListener('click', hideAllForms);

        document.getElementById('showSearchButton').addEventListener('click', function() {
            showSearch();
        });

        document.getElementById('cancelSearchButton').addEventListener('click', hideAllForms);

        document.getElementById('closeHelpButton').addEventListener('click', hideAllForms);

        function hideAllForms() {
            document.querySelectorAll('.form-container, .search-container').forEach(form => {
                form.classList.remove('active');
            });
        }

        function showForm(type) {
            hideAllForms();
            const docNumber = db.generateDocNumber(type);
            if (type === 'incoming') {
                document.getElementById('incomingForm').classList.add('active');
            } else {
                document.getElementById('outgoingForm').classList.add('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showSearch() {
            hideAllForms();
            document.getElementById('searchContainer').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // –î–µ–º–æ –¥–∞–Ω—ñ
        updateStats();
    </script>
</body>
</html>
